import readline from "node:readline";
export async function grepObject(adapter, key, pattern) {
    if (adapter.openReadStream) {
        const stream = await adapter.openReadStream({ key });
        const rl = readline.createInterface({ input: stream, crlfDelay: Infinity });
        const out = [];
        let lineNumber = 0;
        for await (const line of rl) {
            lineNumber++;
            if (pattern.test(line))
                out.push({ lineNumber, line });
        }
        return out;
    }
    if (adapter.readText) {
        const text = await adapter.readText({ key });
        const out = [];
        const lines = text.split(/\r?\n/);
        lines.forEach((line, idx) => {
            if (pattern.test(line))
                out.push({ lineNumber: idx + 1, line });
        });
        return out;
    }
    throw new Error("Adapter does not support read operations needed for grep.");
}
